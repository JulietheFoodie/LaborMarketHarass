---
title: "Data MD1"
author: "Julie Norman"
date: "2/3/2019"
output: html_document
---

#Library

```{r}
library(readxl)
library(readr)
library(dplyr)
library(tidyverse)
library(lubridate)
```

# Harrasment reports 

```{r}
EEOCdf <- read_excel("SH Charge Receipts.xlsx")
#View(SH_Charge_Receipts)
```

```{r}
EEOCdf$DATE <- EEOCdf$CHARGE_FILING_DATE
```


```{r}
EEOCdf$CHARGE_FILING_DATE <- as.Date.POSIXct(EEOCdf$CHARGE_FILING_DATE, "%Y-%m-%d", tz = "GMT")
```

```{r}
EEOCdf$DATEym <- format(EEOCdf$DATE, "%Y-%m")
```


buzzfeed github
https://github.com/BuzzFeedNews/2017-12-eeoc-harassment-charges 


## Clean

```{r}


selectdf <- select(EEOCdf, CHARGE_FILING_DATE, R_NUMBER_OF_EMPLOYEES, R_TYPE, DATE, DATEym, CP_SEX)

```

### Complaintant Gender
```{r}
sex<- table(selectdf$DATEym, selectdf$CP_SEX)

sexdf<- as.data.frame(sex)
sexdf <- reshape(sexdf, idvar = "Var1", timevar = "Var2", direction = "wide")
```

### R_TYPE
```{r}
firmtype<- table(selectdf$DATEym, selectdf$R_TYPE)

firmtypedf<- as.data.frame(firmtype)
firmtypedf <- reshape(firmtypedf, idvar = "Var1", timevar = "Var2", direction = "wide")
```

### R_NUMBER_OF_EMPLOYEES 

```{r}
firmsize <- table(selectdf$DATEym, selectdf$R_NUMBER_OF_EMPLOYEES)

firmsizedf<- as.data.frame(firmsize)
firmsizedf <- reshape(firmsizedf, idvar = "Var1", timevar = "Var2", direction = "wide")
```

```{r}
prt1df <- merge(firmsizedf, firmtypedf, by = "Var1")

eeocdf <- merge(prt1df, sexdf, by = "Var1")

str(eeocdf)
```

### rename columns

```{r}
colnames(eeocdf)[colnames(eeocdf) == "Var1"] <- "DATEym"



eeocdf$count <- eeocdf$`Freq.CP Sex Not Available/Applicable`+ eeocdf$Freq.Female + eeocdf$Freq.Male +eeocdf$Freq.NULL

eeocdf$prop.fem <- eeocdf$Freq.Female/eeocdf$count

eeocdf$prop.priv <- eeocdf$`Freq.Private Employer`/eeocdf$count



```





# Labor Market Momentum Index

```{r}
#Labor Market Conditions Index
LMCIdf <- read_csv("FRBKCLMCIM.csv")


```

```{r}
LMCIdf$DATEym <- format(LMCIdf$DATE, "%Y-%m")
```

https://fred.stlouisfed.org/series/LREM25TTUSM156S#


#Enployment Rate

```{r}
EMPLRTdf <- read_csv("LREM25TTUSM156S.csv")
```

```{r}
EMPLRTdf %>% filter(EMPLRTdf$DATE >= "1995-01-01")
```

```{r}
EMPLRTdf$DATEym <- format(EMPLRTdf$DATE, "%Y-%m")

str(EMPLRTdf$DATEym)
```


https://fred.stlouisfed.org/series/LREM25TTUSM156S#

# Join

```{r}

FINALdf <- list(eeocdf, LMCIdf, EMPLRTdf) %>% 
 reduce(left_join, by = "DATEym") 

#convert to date
FINALdf$DATEymx <- ymd(FINALdf$DATEym,truncated = 1)



str(FINALdf)

```


```{r}
ggplot(FINALdf, aes(x = FINALdf$CP_SEX)) +
  geom_bar()
```

```{r}
ggplot(FINALdf, aes( x = FINALdf$CHARGE_FILING_DATE)) +
  geom_bar()
  
```

```{r}
ggplot(FINALdf, aes( x = FINALdf$DATEym)) +
  geom_bar()
  
```



```{r}
table(FINALdf$DATEym)

ggplot(FINALdf, aes( x = FINALdf$DATEym)) +
  geom_point()
  
```








